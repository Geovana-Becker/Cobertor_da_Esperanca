<!-- /*
* Bootstrap 5
* Template Name: Furni
* Template Author: Untree.co
* Template URI: https://untree.co/
* License: https://creativecommons.org/licenses/by/3.0/
*/ -->
<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="author" content="Untree.co">
    <link rel="shortcut icon" href="favicon.png">

    <meta name="description" content="" />
    <meta name="keywords" content="bootstrap, bootstrap4" />

    <!-- Bootstrap CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link href="css/tiny-slider.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <title>Cobertor da Esperança</title>
</head>

<body>

    <!-- Start Header/Navigation -->
    <nav class="custom-navbar navbar navbar navbar-expand-md navbar-dark bg-dark" arial-label="Furni navigation bar">

        <div class="container">
            <a class="navbar-brand" href="index.html">Cobertor da Esperança<span></span></a>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarsFurni" aria-controls="navbarsFurni" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarsFurni">
                <ul class="custom-navbar-nav navbar-nav ms-auto mb-2 mb-md-0">
                    <li class="nav-item">
                        <a class="nav-link" id="home_menu" href="index.html">Home</a>
                    </li>
                    <li><a class="nav-link" id="doacao-menu" style="display: block;" href="doacao.html">Doações</a></li>
                    <li><a class="nav-link" href="recompensas.html">Recompensas</a></li>
                    <li><a class="nav-link" id="contato-menu" style="display: block;" href="contato.html">Contato</a></li>
                    <li class="active"><a class="nav-link" id="cadastro-recompensas" href="cadastrorecompensas.html" style="display: none;">Cadastro de recompensas</a></li>
                    <li><a class="nav-link" id="gerenciamento-usuarios" href="recompensasfunc.html" style="display: none;">Gerenciamento de usuários</a></li>
                </ul>

                <ul class="custom-navbar-cta navbar-nav mb-2 mb-md-0 ms-5">
                    <li><a class="nav-link" id="botao_login" style="display: block;" href="login.html"><img src="images/user.svg"></a></li>
                </ul>
                <ul class="custom-navbar-cta navbar-nav mb-2 mb-md-0 ms-5">
                    <li><a class="nav-link" id="botao_sair" onclick="logout()" style="cursor: pointer; display: none;">Sair</a></li>
                </ul>
            </div>
        </div>

    </nav>
    <!-- End Header/Navigation -->
    <!-- Start Hero Section -->
    <div class="hero">
        <div class="container">
            <div class="row justify-content-between">
                <div class="col-lg-5">
                    <div class="intro-excerpt">
                        <h1>Recompensas</h1>
                        <p class="mb-4">Cadastro das recompensas dos usuários.</p>
                        <p><a href="login.html" class="btn btn-white-outline" id="botao-entrar2">Entrar</a></p>
                    </div>
                </div>
                <div class="col-lg-7">
                    <div class="hero-img-wrap">
                        <img src="images/couch.png" class="img-fluid">
                    </div>
                </div>
            </div>
        </div>
    </div>
    <br>
    <!-- End Hero Section -->



    <div class="untree_co-section before-footer-section">
        <div class="container">
            <form id="form-recompensas">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Imagem</th>
                            <th>Nome</th>
                            <th>Descrição</th>
                            <th>Valor</th>
                            <th>Ação</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                <input type="file" id="imagem-upload" accept="image/*" class="form-control" required>
                            </td>
                            <td>
                                <input type="text" id="nome-produto" class="form-control" placeholder="Nome do Produto" required>
                            </td>
                            <td>
                                <textarea id="descricao-produto" class="form-control custom-textarea" placeholder="Descrição" required></textarea>
                            </td>
                            <td>
                                <input type="number" id="valor-produto" class="form-control" placeholder="Valor" required>
                            </td>
                            <td>
                                <button type="submit" id="botao-add" class="btn btn-primary">Adicionar</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </form>
            <div id="mensagem-feedback" class="mt-3"></div>
        </div>
    </div>
    <br> <br>


    <!-- Start Footer Section -->
    <footer class="footer-section">
        <div class="container relative">

            <div class="sofa-img">
                <img src="images/sofa.png" alt="Image" class="img-fluid">
            </div>

            <div class="row g-5 mb-5">
                <div class="col-lg-4">
                    <div class="mb-4 footer-logo-wrap"><a href="#" class="footer-logo">Cobertor da Esperança<span></span></a></div>
                    <p class="mb-4">Compartilhe amor, aqueça corações. Cada peça doada é um passo para um mundo mais gentil. Obrigado por fazer parte dessa corrente do bem!</p>


                </div>

                <div class="col-lg-8">
                    <div class="row links-wrap">
                        <div class="col-6 col-sm-6 col-md-3">
                            <ul class="list-unstyled">
                                <li><a href="recompensas.html">Recompensas</a></li>
                            </ul>
                        </div>
                    </div>
                </div>

            </div>

            <div class="border-top copyright">
                <div class="row pt-4">
                    <div class="col-lg-6">
                        <p class="mb-2 text-center text-lg-start">
                            Copyright &copy;
                            <script>document.write(new Date().getFullYear());</script> Cobertor da Esperança.  Todos os direitos reservados.
                        </p>
                    </div>



                </div>
            </div>

        </div>
    </footer>
	<!--ancora-->
  <a href="#" class="back-to-top">
	<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16">
		<path fill-rule="evenodd" d="M8 12a.5.5 0 0 0 .5-.5V5.707l2.146 2.147a.5.5 0 0 0 .708-.708l-3-3a.5.5 0 0 0-.708 0l-3 3a.5.5 0 1 0 .708.708L7.5 5.707V11.5a.5.5 0 0 0 .5.5"/>
	</svg>
</a>
<!--ancora-->
    <!-- End Footer Section -->
    <script>

        document.addEventListener('DOMContentLoaded', function () {
            const userId = localStorage.getItem('userId'); // Recupera o ID do usuário do localStorage
            const isAuthenticatedFuncionario = localStorage.getItem('funcionario_authenticated') === 'true';

            // Verifica se o usuário está logado como funcionário
            if (isAuthenticatedFuncionario) {
                // Se o usuário for um funcionário, esconde os links de Home, Doações e Contato
                document.getElementById('home_menu').style.display = 'none';
                document.getElementById('doacao-menu').style.display = 'none';
                document.getElementById('contato-menu').style.display = 'none';
            } else {
                // Se o usuário não for funcionário, mostra os links de Home, Doações e Contato
                document.getElementById('home_menu').style.display = 'block';
                document.getElementById('doacao-menu').style.display = 'block';
                document.getElementById('contato-menu').style.display = 'block';
            }

            // Chama a função para carregar as recompensas
        });

        document.getElementById('form-recompensas').addEventListener('submit', async function (event) {
            event.preventDefault();

            // Obtém os valores do formulário
            const nome = document.getElementById('nome-produto').value.trim();
            const descricao = document.getElementById('descricao-produto').value.trim();
            const valor = document.getElementById('valor-produto').value.trim();
            const imagemInput = document.getElementById('imagem-upload');

            // Validações simples
            if (!nome || !descricao || !valor) {
                alert("Todos os campos são obrigatórios.");
                return;
            }

            if (imagemInput.files.length === 0) {
                alert("Por favor, selecione uma imagem.");
                return;
            }

            // Converte a imagem para Base64
            const file = imagemInput.files[0];
            const reader = new FileReader();

            reader.onload = async function (e) {
                const imagemBase64 = e.target.result.split(',')[1]; // Remove o prefixo data:image/...;base64,

                // Monta o objeto recompensa
                const recompensa = {
                    IMAGEM: imagemBase64,
                    NOME: nome,
                    DESCRICAO: descricao,
                    VALOR: valor, // Certifica-se que o valor seja numérico
                    "codigo": "string"
                };

                try {
                    // Exibe um indicador de carregamento
                    const feedbackDiv = document.getElementById('mensagem-feedback');
                    feedbackDiv.innerHTML = "Enviando dados, aguarde...";
                    feedbackDiv.style.color = "blue";

                    const response = await fetch('https://localhost:7177/Recompensas', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(recompensa)
                    });

                    if (response.ok) {
                        alert('Recompensa cadastrada com sucesso!');
                        document.getElementById('form-recompensas').reset();
                        feedbackDiv.innerHTML = "Recompensa cadastrada com sucesso!";
                        feedbackDiv.style.color = "green";
                    } else {
                        alert('Erro ao cadastrar a recompensa. Verifique os dados.');
                        feedbackDiv.innerHTML = "Erro ao cadastrar a recompensa.";
                        feedbackDiv.style.color = "red";
                    }
                } catch (error) {
                    console.error('Erro na requisição:', error);
                    alert('Erro na comunicação com o servidor.');
                    document.getElementById('mensagem-feedback').innerHTML = "Erro na comunicação com o servidor.";
                    document.getElementById('mensagem-feedback').style.color = "red";
                }
            };

            reader.readAsDataURL(file);
        });
    </script>

    <script src="js/funcionarios.js"></script>
    <script src="js/sistema.js"></script>
    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/tiny-slider.js"></script>
    <script src="js/custom.js"></script>
</body>

</html>
